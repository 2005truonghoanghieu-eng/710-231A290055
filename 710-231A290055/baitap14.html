<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Bài tập 14 - Game Ghép đôi thẻ (Memory Matching)</title>

    <style>
        :root {
            --bg: #0b1220;
            --card: #111b2e;
            --card2: #0f172a;
            --text: #e5e7eb;
            --muted: #94a3b8;
            --accent: #38bdf8;
            --good: #22c55e;
            --danger: #fb7185;
            --shadow: 0 10px 30px rgba(0,0,0,.35);
            --radius: 16px;
        }

        * {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
            color: var(--text);
            background: radial-gradient(1200px 600px at 20% 0%, rgba(56,189,248,.15), transparent 55%), radial-gradient(900px 500px at 90% 10%, rgba(34,197,94,.12), transparent 55%), var(--bg);
            min-height: 100vh;
            display: grid;
            place-items: center;
            padding: 18px;
        }

        header, main, footer {
            width: min(880px, 100%);
        }

        header {
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            justify-content: space-between;
            gap: 12px;
            margin-bottom: 14px;
        }

        .title {
            display: grid;
            gap: 4px;
        }

            .title h1 {
                margin: 0;
                font-size: clamp(18px, 2.6vw, 26px);
                letter-spacing: .2px;
            }

            .title p {
                margin: 0;
                color: var(--muted);
                font-size: 14px;
                line-height: 1.35;
            }

        .hud {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            align-items: center;
            justify-content: flex-end;
        }

        .badge {
            background: rgba(255,255,255,.06);
            border: 1px solid rgba(255,255,255,.12);
            border-radius: 999px;
            padding: 8px 12px;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            box-shadow: var(--shadow);
            backdrop-filter: blur(8px);
            font-size: 14px;
        }

            .badge b {
                color: #fff;
            }

        .btn {
            cursor: pointer;
            border: none;
            color: #071018;
            background: linear-gradient(135deg, #67e8f9, #38bdf8);
            border-radius: 999px;
            padding: 10px 14px;
            font-weight: 700;
            box-shadow: var(--shadow);
            transition: transform .12s ease, filter .12s ease;
        }

            .btn:hover {
                transform: translateY(-1px);
                filter: brightness(1.04);
            }

            .btn:active {
                transform: translateY(0px) scale(.99);
            }

        main {
            background: rgba(255,255,255,.04);
            border: 1px solid rgba(255,255,255,.10);
            border-radius: var(--radius);
            padding: 14px;
            box-shadow: var(--shadow);
            backdrop-filter: blur(8px);
        }

        /* Grid layout: mobile 2 cột, desktop 4 cột */
        .grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            padding: 6px;
        }

        @media (min-width: 720px) {
            .grid {
                grid-template-columns: repeat(4, 1fr);
            }
        }

        /* Card flip 3D */
        .card {
            aspect-ratio: 1 / 1;
            perspective: 1000px;
        }

            .card button {
                width: 100%;
                height: 100%;
                border: none;
                padding: 0;
                cursor: pointer;
                background: transparent;
                border-radius: 14px;
                outline: none;
            }

        .inner {
            width: 100%;
            height: 100%;
            position: relative;
            transform-style: preserve-3d;
            transition: transform 450ms cubic-bezier(.2,.8,.2,1);
            border-radius: 14px;
        }

        /* Hover effect (chỉ khi chưa lật & chưa match) */
        .card:not(.flipped):not(.matched) .inner {
            filter: drop-shadow(0 8px 14px rgba(0,0,0,.25));
        }

        .card:not(.flipped):not(.matched) button:hover .inner {
            transform: translateY(-2px) rotateX(2deg) rotateY(-2deg);
        }

        .face {
            position: absolute;
            inset: 0;
            border-radius: 14px;
            backface-visibility: hidden;
            display: grid;
            place-items: center;
            user-select: none;
            border: 1px solid rgba(255,255,255,.10);
        }

        .front {
            background: linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.03));
            color: rgba(255,255,255,.9);
            font-size: clamp(18px, 4.5vw, 28px);
            letter-spacing: .5px;
        }

        .back {
            transform: rotateY(180deg);
            background: radial-gradient(300px 200px at 30% 20%, rgba(56,189,248,.18), transparent 55%), radial-gradient(300px 200px at 70% 80%, rgba(34,197,94,.14), transparent 55%), var(--card2);
            font-size: clamp(30px, 7vw, 46px);
        }

        .card.flipped .inner {
            transform: rotateY(180deg);
        }

        .card.matched .face {
            border-color: rgba(34,197,94,.45);
            box-shadow: 0 0 0 2px rgba(34,197,94,.15) inset;
        }

        .card.matched .back {
            background: radial-gradient(320px 220px at 30% 20%, rgba(34,197,94,.22), transparent 55%), radial-gradient(320px 220px at 70% 80%, rgba(56,189,248,.12), transparent 55%), var(--card);
        }

        .status {
            margin-top: 12px;
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            justify-content: space-between;
            gap: 10px;
        }

        .message {
            min-height: 24px;
            color: var(--muted);
            font-size: 14px;
        }

            .message.success {
                color: var(--good);
                font-weight: 700;
            }

            .message.fail {
                color: var(--danger);
                font-weight: 700;
            }

        footer {
            margin-top: 12px;
            color: rgba(148,163,184,.85);
            font-size: 12px;
            text-align: center;
        }

        /* Accessibility focus */
        .card button:focus-visible .inner {
            outline: 3px solid rgba(56,189,248,.8);
            outline-offset: 4px;
            border-radius: 14px;
        }
    </style>
</head>

<body>
    <header>
        <div class="title">
            <h1>Game Ghép Đôi Thẻ (Memory Matching) — 8 thẻ (4 cặp)</h1>
            <p>Click để lật thẻ. Khớp thì giữ nguyên, không khớp sẽ lật lại. Đếm lượt (moves) và báo thắng.</p>
        </div>

        <div class="hud" aria-label="Bảng điều khiển">
            <div class="badge" aria-live="polite">Moves: <b id="moves">0</b></div>
            <div class="badge" aria-live="polite">Matched: <b id="matched">0</b>/4</div>
            <button class="btn" id="resetBtn" type="button">Reset game</button>
        </div>
    </header>

    <main>
        <section aria-label="Khu vực thẻ">
            <div class="grid" id="grid" role="grid" aria-label="Bàn chơi 8 thẻ">
                <!-- Cards render by JS -->
            </div>
        </section>

        <div class="status" aria-label="Trạng thái trò chơi">
            <div class="message" id="message" aria-live="polite"></div>
            <div class="message" id="hint">Tip: Trên điện thoại hiển thị 2 cột, trên máy tính 4 cột.</div>
        </div>
    </main>

    <footer>
        © Bài tập 14 - Lập trình Web | 1 file baitap14.html (HTML + CSS + JS)
    </footer>

    <script>
    // ===== Data =====
    // 4 cặp => tổng 8 thẻ
    const symbols = ["🍀","⚡","🎧","💎"]; // bạn có thể đổi icon tùy ý
    let cards = [];

    // ===== State =====
    let firstCard = null;
    let secondCard = null;
    let lockBoard = false;
    let moves = 0;
    let matchedPairs = 0;

    const gridEl = document.getElementById("grid");
    const movesEl = document.getElementById("moves");
    const matchedEl = document.getElementById("matched");
    const messageEl = document.getElementById("message");
    const resetBtn = document.getElementById("resetBtn");

    // ===== Helpers =====
    function shuffle(array){
      // Fisher–Yates
      for(let i = array.length - 1; i > 0; i--){
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
      return array;
    }

    function setMessage(text, type = ""){
      messageEl.textContent = text;
      messageEl.className = "message" + (type ? " " + type : "");
    }

    function updateHUD(){
      movesEl.textContent = String(moves);
      matchedEl.textContent = String(matchedPairs);
    }

    function createDeck(){
      // tạo 2 bản sao mỗi symbol => 8 thẻ
      const deck = [];
      symbols.forEach((sym, idx) => {
        deck.push({ id: cryptoRandomId(), pair: idx, symbol: sym });
        deck.push({ id: cryptoRandomId(), pair: idx, symbol: sym });
      });
      return shuffle(deck);
    }

    function cryptoRandomId(){
      // id ngắn, tránh trùng
      return (crypto?.getRandomValues ? crypto.getRandomValues(new Uint32Array(1))[0] : Math.random()*1e9) + "-" + Date.now();
    }

    function render(){
      gridEl.innerHTML = "";
      cards.forEach((c) => {
        const wrap = document.createElement("article");
        wrap.className = "card";
        wrap.setAttribute("role", "gridcell");
        wrap.dataset.id = c.id;
        wrap.dataset.pair = c.pair;

        // button để focus/keyboard tốt hơn
        wrap.innerHTML = `
          <button type="button" aria-label="Thẻ úp. Bấm để lật">
            <div class="inner">
              <div class="face front" aria-hidden="true">?</div>
              <div class="face back" aria-hidden="true">${c.symbol}</div>
            </div>
          </button>
        `;

        wrap.querySelector("button").addEventListener("click", () => onFlip(wrap));
        gridEl.appendChild(wrap);
      });
    }

    // ===== Game logic =====
    function onFlip(cardEl){
      if(lockBoard) return;
      if(cardEl.classList.contains("matched")) return;
      if(cardEl === firstCard) return;

      cardEl.classList.add("flipped");

      if(!firstCard){
        firstCard = cardEl;
        return;
      }

      secondCard = cardEl;
      moves++;
      updateHUD();

      checkMatch();
    }

    function checkMatch(){
      const isMatch = firstCard.dataset.pair === secondCard.dataset.pair;

      if(isMatch){
        firstCard.classList.add("matched");
        secondCard.classList.add("matched");
        matchedPairs++;
        updateHUD();
        setMessage("Chuẩn! Ghép đúng 1 cặp ✅", "success");

        resetTurn();

        if(matchedPairs === symbols.length){
          setMessage(`Bạn đã thắng! 🎉 Tổng moves: ${moves}`, "success");
        }
      }else{
        lockBoard = true;
        setMessage("Chưa khớp, lật lại nha ✨", "fail");

        setTimeout(() => {
          firstCard.classList.remove("flipped");
          secondCard.classList.remove("flipped");
          resetTurn();
        }, 850);
      }
    }

    function resetTurn(){
      [firstCard, secondCard] = [null, null];
      lockBoard = false;
    }

    function resetGame(){
      moves = 0;
      matchedPairs = 0;
      lockBoard = false;
      firstCard = null;
      secondCard = null;

      cards = createDeck();
      render();
      updateHUD();
      setMessage("Game đã reset. Chơi lại nào! 👇");
    }

    resetBtn.addEventListener("click", resetGame);

    // init
    resetGame();
    </script>
</body>
</html>
